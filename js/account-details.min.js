!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=12)}([function(e,t){e.exports=angular},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),u=n(2),o=r(u),c=n(8),l=r(c);t.default=a.default.module("tw.account-details.service",[o.default]).service("AccountDetailsService",l.default).name},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),u=n(7),o=r(u);t.default=a.default.module("tw.account-details.legacy",[]).service("AccountDetailsLegacyService",o.default).name},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),u=n(5),o=r(u),c=n(1),l=r(c);t.default=a.default.module("tw.account-details.create",[l.default,"tw.styleguide-components"]).component("accountDetailsCreate",o.default).name},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),u=n(13),o=r(u),c=n(1),l=r(c),s=n(11),d=r(s);t.default=a.default.module("tw.account-details.multi-create",[l.default,d.default]).component("multiAccountCreate",o.default).name},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),a=r(i),u=n(15),o=r(u),c={controller:a.default,template:o.default,bindings:{currency:"<",quoteId:"<",profileId:"<",onChange:"&",onSuccess:"&",onFailure:"&",saveButtonLabel:"<"}};t.default=c},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t,n){r(this,e),this.$scope=t,this.AccountDetailsService=n,this.translations={validation:{required:"Field is required",pattern:"Invalid format",minLength:"The value is too short",maxLength:"Too value is too long",min:"The value is too low",max:"Too value is too high"},country:{label:"Which country is their account in?"},accountDetails:{label:"Do you have their account details?",value:"Yes, I have their details",info:"No problem, we'll send your recipient an email asking them where\n          they want to receive the money."}},this.model={},this.uniqueIdRecipient=!1,this.hasDetails=!0}return i(e,[{key:"$onInit",value:function(){var e=this;this.currency||(this.currency="GBP"),this.$scope.$watch("$ctrl.model",function(t,n){t!==n&&e.onChange&&e.onChange({model:t})},!0)}},{key:"$onChanges",value:function(e){var t=this;e.currency&&(this.model.currency=e.currency.currentValue||"GBP",this.AccountDetailsService.getTargetCountries(this.model.currency).then(function(e){t.targetCountries=e.data,"USD"===t.model.currency&&(t.model.country="US"),t.targetCountries&&t.targetCountries.length<=1&&delete t.model.country}).catch(function(){})),e.profile&&e.profile.currentValue&&(this.model.profile=e.profile.currentValue),(e.currency||e.quoteId)&&this.loadRequirements()}},{key:"loadRequirements",value:function(){var e=this,t=void 0;t=this.quoteId?this.AccountDetailsService.getRequirementsForQuote(this.quoteId,this.model.currency):this.AccountDetailsService.getRequirements(this.model.currency,this.model.country),t.then(function(t){e.alternatives=t.data,e.alternatives.length&&(e.model.type=e.alternatives[0].type)}).catch(this.handleRequirementsFailure)}},{key:"refreshRequirements",value:function(){var e=this;this.AccountDetailsService.refreshRequirements(this.model.currency,this.model).then(function(t){e.alternatives=t.data}).catch(this.handleRequirementsFailure)}},{key:"handleRequirementsFailure",value:function(e){}},{key:"saveAccount",value:function(){var e=this;this.AccountDetailsService.save(this.model).then(function(){e.onSuccess&&e.onSuccess()}).catch(function(t){e.errors=t,e.onFailure&&e.onFailure()})}},{key:"onEmailChange",value:function(e){this.model.email=e}},{key:"onUseUniqueId",value:function(e){this.uniqueIdRecipient=e}},{key:"onEnterManually",value:function(){this.uniqueIdRecipient=!1}},{key:"isCountrySelectorVisible",value:function(){return!this.uniqueIdRecipient&&this.hasDetails&&this.targetCountries&&this.targetCountries.length>1}},{key:"isAccountFormVisible",value:function(){return!this.uniqueIdRecipient&&this.hasDetails}}]),e}();a.$inject=["$scope","AccountDetailsService"],t.default=a},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e){var t={},n={};return Object.keys(e).forEach(function(r){var i=v[r];"address"!==r&&"name"!==r&&(i?t[i]=e[r]:n[r]=e[r])}),e.name&&(t.name=e.name),n.details&&n.details.properties?t.details=n.details:t.details={type:"object",properties:n},e.address&&(t.address=e.address),t}function a(e,t){var n=angular.extend({},e);return n=u(n,t)}function u(e,t){if(y[t])return angular.extend(y[t],e);var n={name:{type:"object",properties:{fullName:{type:"string",title:"Name",placeholder:"Enter name..."}}}},r=n;return $[t]&&(r.name.properties=o(n.name.properties,$[t])),angular.extend(r,e)}function o(e,t){if(!t)return e;var n={};return Object.keys(e).forEach(function(r){"legalType"===r?n.legalEntityType=l(e[r]):n[r]=c(r,e[r],t[r])}),n}function c(e,t,n){return n?("address"===e&&(t.title="Address details"),"object"===t.type?(t.properties=o(t.properties,n),t):angular.extend(t,n)):t}function l(e){return delete e.control,e.values&&e.values.forEach(function(e){"PRIVATE"===e.value&&(e.value="PERSON"),"BUSINESS"===e.value&&(e.value="INSTITUTION")}),e}function s(e,t){var n="/api/v1/recipient/swiftAccountNumberFormat?recipientCountry="+t;return e.get(n).then(function(e){return e.data.accountNumberFormat})}function d(e,t,n){var r=h(e.data,"swift_code");return s(t,n).then(function(t){return e.data="IBAN"===t?f(r):r,e})}function f(e){var t={},n=e[0].properties.details.properties;return Object.keys(n).forEach(function(e){"accountNumber"===e?t.IBAN={name:"IBAN",type:"text",required:!0,minLength:2,placeholder:"IBAN"}:t[e]=n[e]}),e[0].properties.details.properties=t,e}function h(e,t){return e.filter(function(e){return e.type===t})}Object.defineProperty(t,"__esModule",{value:!0});var p=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),m=function(){function e(t,n){r(this,e),this.RequirementsService=t,this.$http=n}return p(e,[{key:"prepareResponse",value:function(e,t){t.alternatives&&(t=t.alternatives);var n=this.RequirementsService.prepRequirements(t).filter(function(e){return Object.keys(e.properties).length>0});return n.forEach(function(t){var n=b[e]&&b[e][t.type];t.properties=a(t.properties,e),t.properties=o(t.properties,n),t.properties=o(t.properties,g),t.properties=i(t.properties)}),n}},{key:"formatModelForAPI",value:function(e){return e}},{key:"formatErrorsForDisplay",value:function(e){var t={};return Array.isArray(e)&&e.forEach(function(e){if(e.path&&e.path.indexOf(".")>0){var n=e.path.split("."),r=n[0];t[r]||(t[r]={}),t[r][n[1]]=e.message}else t[e.path]=e.message}),t}},{key:"modifyUSD",value:function(e,t){var n=this;return e&&"US"!==e?t.then(function(t){return d(t,n.$http,e)}):t.then(function(e){return e.data=h(e.data,"aba"),e})}}]),e}(),v={type:"type",legalEntityType:"legalEntityType",profile:"profile",accountHolderName:"accountHolderName",currency:"currency",email:"email"},y={ZAR:{name:{type:"object",properties:{firstName:{type:"string",title:"First name",required:!0,helpText:"Name must match name registered with bank"},middleName:{type:"string",title:"Middle name (optional)",helpText:"Name must match name registered with bank"},lastName:{type:"string",title:"Last name",required:!0,helpText:"Name must match name registered with bank"}}}},RUB:{name:{type:"object",properties:{givenName:{type:"string",title:"Given name",required:!0,pattern:"^[а-яА-ЯёЁ' -]+$",helpText:"Name must be in Cyrillic"},patronymicName:{type:"string",title:"Patronymic name",pattern:"^[а-яА-ЯёЁ' -]+$",required:!0,helpText:"Name must be in Cyrillic"},familyName:{type:"string",title:"Family name",required:!0,pattern:"^[а-яА-ЯёЁ' -]+$",helpText:"Name must be in Cyrillic"}}}}},g={address:{city:{width:"md"},postCode:{width:"md"}}},b={USD:{aba:{abartn:{width:"md"},accountNumber:{width:"md"}}},GBP:{sort_code:{sortCode:{width:"md"},accountNumber:{width:"md"}}}},$={VND:{fullName:{helpText:"Enter the name exactly as it appears on the recipient's Vietnamese bank account.  A mismatch may cause a delay on your transfer"}},COP:{fullName:{helpText:"Please include all of the recipient's given and family names."}},JPY:{fullName:{helpText:"Enter the name exactly as it appears on the recipient's Japanese bank account (it is usually writtin in XXXX Katakana).  A mismatch may cause a delay or rejection of your transfer."}}};m.$inject=["TwRequirementsService","$http"],t.default=m},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){var n="/account-requirements?target="+e;return t&&(n+="&country="+t),n}function a(e,t,n){return{transformResponse:l(function(n,r,i){return u(e,n,i,t)},n)}}function u(e,t,n,r){return 200===n?r.prepareResponse(e,t):t}function o(e,t){return{transformResponse:l(function(e,n,r){return c(e,r,t)},e)}}function c(e,t,n){return 200===t?e:n.formatErrorsForDisplay(e)}function l(e,t){return t.defaults.transformResponse&&t.defaults.transformResponse.concat&&t.defaults.transformResponse.concat(e)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d=function(){function e(t,n,i){r(this,e),this.$http=t,this.$q=n,this.LegacyService=i}return s(e,[{key:"getRequirements",value:function(e,t){if(!e)throw new Error("Currency is required");var n=a(e,this.LegacyService,this.$http),r=i(e,t),u=this.$http.get(r,n);return"USD"===e&&(u=this.LegacyService.modifyUSD(t,u)),u}},{key:"getRequirementsForQuote",value:function(e,t,n){if(!e||!t)throw new Error("Quote id and currency are required");var r=a(t,this.LegacyService,this.$http),i="/quotes/"+e+"/account-requirements",u=this.$http.get(i,r);return"USD"===t&&(u=this.LegacyService.modifyUSD(n,u)),u}},{key:"refreshRequirements",value:function(e,t){if(!e)throw new Error("Currency is required");var n=this.LegacyService.formatModelForAPI(t),r=a(e,this.LegacyService,this.$http),u=i(e,t.country),o=this.$http.post(u,n,r);return"USD"===e&&(o=this.LegacyService.modifyUSD(t.country,o)),o}},{key:"getAccountCurrencies",value:function(){return this.$http.get("/account-currencies")}},{key:"save",value:function(e){if(!e)throw new Error("Model is required");var t=this.LegacyService.formatModelForAPI(e),n=o(this.$http,this.LegacyService);return this.$http.post("/accounts",t,n)}},{key:"lookupAccountByEmail",value:function(e){if(!e)throw new Error("Email is required");return this.$http.post("/api/v1/uniqueId/uniqueIdLookUp",{email:e,type:"email",currencyCode:"GBP"})}},{key:"getTargetCountries",value:function(e){return"USD"===e?this.$http.get("/api/v1/country/listGlobalUsdCountries").then(function(e){return e.data=e.data.countries.map(function(e){return{value:e.iso2Code,label:e.name}}),e}).catch(function(){return{data:[{currency:"USD"}]}}):this.$q.when({data:[{currency:"GBP"}]})}}]),e}();d.$inject=["$http","$q","AccountDetailsLegacyService"],t.default=d},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(10),a=r(i),u=n(16),o=r(u),c={controller:a.default,template:o.default,bindings:{onChange:"&",onUseUniqueId:"&",onEnterManually:"&"}};t.default=c},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t){r(this,e),this.AccountDetailsService=t,this.requestCount=0,this.lastResponse=0,this.translations={email:{label:"Email address",placeholder:"Recipient email address",success:"is already on TransferWise, and would like to receive into the\n          following account."},uniqueId:{label:"How do you want to send?",toUniqueId:"account ending",toBankDetails:"Send to a different account"}}}return i(e,[{key:"onEmailChange",value:function(){var e=this;if(this.onChange&&this.onChange({email:this.email}),!this.email)return this.recipient=!1,void(this.useUniqueId=!1);this.requestCount++;var t=this.requestCount;this.AccountDetailsService.lookupAccountByEmail(this.email).then(function(n){e.lastResponse>t||(e.recipient=n.data.targetRecipient,e.useUniqueId=!0,e.selectUniqueId())}).catch(function(){e.lastResponse>t||(e.selectManual(),e.recipient=!1,e.useUniqueId=!1)}).finally(function(){e.lastResponse=Math.max(t,e.lastResponse)})}},{key:"selectUniqueId",value:function(){this.onUseUniqueId&&this.onUseUniqueId({recipient:this.recipient})}},{key:"selectManual",value:function(){this.onEnterManually&&this.onEnterManually()}},{key:"onChangeUniqueIdChoice",value:function(e){e.useUniqueId?this.selectUniqueId():this.selectManual()}}]),e}();a.$inject=["AccountDetailsService"],t.default=a},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),u=n(9),o=r(u),c=n(1),l=r(c);t.default=a.default.module("tw.account-details.email-lookup",[l.default]).component("accountEmailLookup",o.default).name},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),u=n(2),o=r(u),c=n(1),l=r(c),s=n(3),d=r(s),f=n(4),h=r(f);t.default=a.default.module("tw.account-details",[o.default,l.default,d.default,h.default]).name},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(14),a=r(i),u=n(17),o=r(u),c={controller:a.default,template:o.default,bindings:{profileId:"<",onChange:"&",onSuccess:"&",onFailure:"&",saveButtonLabel:"<"}};t.default=c},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t){r(this,e),this.AccountDetailsService=t,this.translations={currency:{label:"Currency",placeholder:"Choose currency"}}}return i(e,[{key:"$onInit",value:function(){var e=this;this.currency||(this.currency="USD"),this.currencies=[],this.AccountDetailsService.getAccountCurrencies().then(function(t){e.currencies=t.data}).catch(function(){})}},{key:"onSaveSuccess",value:function(){this.onSuccess&&this.onSuccess()}},{key:"onSaveFailure",value:function(){this.onFailure&&this.onFailure()}},{key:"onModelChange",value:function(e){this.onChange&&this.onChange({model:e})}}]),e}();a.$inject=["AccountDetailsService"],t.default=a},function(e,t){e.exports='\n<div class="form-group">\n  <label class="control-label">\n    {{ $ctrl.translations.accountDetails.label }}\n  </label>\n  <div class="checkbox" ng-class="{ \'has-info\': !$ctrl.hasDetails }">\n    <label>\n      <tw-checkbox\n        ng-init="$ctrl.hasDetails = true;"\n        ng-model="$ctrl.hasDetails"\n        ng-true-value="true"\n        ng-false-value="false" checked></tw-checkbox>\n      {{ $ctrl.translations.accountDetails.value }}\n    </label>\n    <div class="alert alert-info" ng-if="!$ctrl.hasDetails">\n      {{ $ctrl.translations.accountDetails.info }}\n    </div>\n  </div>\n</div>\n\n<account-email-lookup\n  on-change="$ctrl.onEmailChange(email)"\n  on-use-unique-id="$ctrl.onUseUniqueId(recipient)"\n  on-enter-manually="$ctrl.onEnterManually()"\n></account-email-lookup>\n\n<div class="form-group"\n  ng-if="$ctrl.isCountrySelectorVisible()">\n  <label class="control-label">\n    {{ $ctrl.translations.country.label }}\n  </label>\n  <tw-select\n    ng-model="$ctrl.model.country"\n    options="$ctrl.targetCountries"\n    ng-change="$ctrl.refreshRequirements()"\n    name="targetCountry"\n  ></tw-select>\n</div>\n\n<form\n  ng-if="$ctrl.isAccountFormVisible()"\n  name="accountCreateForm"\n  novalidate\n  ng-submit="accountCreateForm.$valid && $ctrl.saveAccount()"\n  ng-class="{\'m-t-panel\': $ctrl.alternatives.length > 1}">\n\n  <tw-requirements-form\n    ng-if="$ctrl.alternatives"\n    model="$ctrl.model"\n    requirements="$ctrl.alternatives"\n    error-messages="$ctrl.errors"\n    validation-messages="$ctrl.translations.validation"\n    on-refresh-requirements="$ctrl.refreshRequirements()">\n  </tw-requirements-form >\n  <input type="submit"\n    value="{{ $ctrl.saveButtonLabel }}"\n    class="btn btn-block btn-primary" />\n</form>\n'},function(e,t){e.exports='<div class="form-group"\n  ng-class="{ \'has-success\': $ctrl.recipient }">\n  <label class="control-label">\n    {{ $ctrl.translations.email.label }}\n  </label>\n  <input\n    name="email"\n    class="form-control"\n    placeholder="{{ $ctrl.translations.email.placeholder }}"\n    ng-model="$ctrl.email"\n    ng-model-options="{ debounce: 500 }"\n    ng-change="$ctrl.onEmailChange()" />\n  <div class="alert alert-success" ng-if="$ctrl.recipient">\n    {{ $ctrl.recipient.name }} {{ $ctrl.translations.email.success }}\n  </div>\n</div>\n<div class="form-group"\n  ng-if="$ctrl.recipient">\n  <label class="control-label">\n    {{ $ctrl.translations.uniqueId.label }}\n  </label>\n  <div class="radio radio-lg">\n    <label>\n      <tw-radio\n        name="uniqueId"\n        ng-value="true"\n        ng-model="$ctrl.useUniqueId"\n        ng-change="$ctrl.onChangeUniqueIdChoice({ useUniqueId: true })"></tw-radio>\n      {{ $ctrl.recipient.name }}\n      <small>\n        {{ $ctrl.recipient.currency }} {{ $ctrl.translations.uniqueId.toUniqueId }}\n        {{ $ctrl.recipient.shortAccountString.slice(-4) }}\n      </small>\n    </label>\n  </div>\n  <div class="radio">\n    <label>\n      <tw-radio\n        name="uniqueId"\n        ng-value="false"\n        ng-model="$ctrl.useUniqueId"\n        ng-change="$ctrl.onChangeUniqueIdChoice({ useUniqueId: false })"></tw-radio>\n      {{ $ctrl.translations.uniqueId.toBankDetails }}\n    </label>\n  </div>\n</div>\n'},function(e,t){e.exports='\n<div class="form-group">\n  <label class="control-label">{{ $ctrl.translations.currency.label }}</label>\n  <tw-select\n    ng-model="$ctrl.currency"\n    options="$ctrl.currencies"\n    placeholder="$ctrl.translations.currency.placeholder"\n  ></tw-select>\n</div>\n\n<account-details-create\n  profile-id="$ctrl.profileId"\n  currency="$ctrl.currency"\n  email="$ctrl.email"\n  on-change="$ctrl.onModelChange(model)"\n  on-success="$ctrl.onSaveSuccess()"\n  on-failure="$ctrl.onSaveFailure()"\n  save-button-label="$ctrl.saveButtonLabel">\n</account-details-create>\n'}]);